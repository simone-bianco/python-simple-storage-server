{% extends "base.html" %}

{% block title %}Statistics - Simple Storage{% endblock %}

{% block body %}
<div class="app-layout">
    {% include "partials/sidebar.html" %}
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">üìä Statistics</h1>
            <p class="page-subtitle">Panoramica utilizzo storage e sistema</p>
        </div>
        
        <!-- Disk Usage Card -->
        <div class="stats-grid mb-4">
            <div class="stat-card">
                <div class="stat-icon primary">üíæ</div>
                <div class="stat-content">
                    <div class="stat-value">{{ disk.used_human }}</div>
                    <div class="stat-label">Spazio Utilizzato</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-value">{{ disk.free_human }}</div>
                    <div class="stat-label">Spazio Disponibile</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon accent">üì¶</div>
                <div class="stat-content">
                    <div class="stat-value">{{ disk.total_human }}</div>
                    <div class="stat-label">Spazio Totale</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon {{ 'danger' if disk.percent > 90 else 'warning' if disk.percent > 70 else 'success' }}">üìà</div>
                <div class="stat-content">
                    <div class="stat-value">{{ disk.percent }}%</div>
                    <div class="stat-label">Utilizzo Disco</div>
                </div>
            </div>
        </div>
        
        <!-- Disk Usage Chart -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="card-title">üíΩ Utilizzo Disco</h2>
            </div>
            <div class="card-body">
                <div class="disk-chart-container">
                    <div class="disk-chart">
                        <div class="disk-chart-bar">
                            <div class="disk-chart-fill" style="width: {{ disk.percent }}%"></div>
                        </div>
                        <div class="disk-chart-labels">
                            <span>0%</span>
                            <span>Usato: {{ disk.percent }}%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    <div class="disk-legend mt-3">
                        <div class="disk-legend-item">
                            <span class="disk-legend-color used"></span>
                            <span>Utilizzato ({{ disk.used_human }})</span>
                        </div>
                        <div class="disk-legend-item">
                            <span class="disk-legend-color free"></span>
                            <span>Libero ({{ disk.free_human }})</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Storage Files Stats -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="card-title">üìÅ Statistiche File</h2>
            </div>
            <div class="card-body">
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <div class="stat-item-value">{{ files.total }}</div>
                        <div class="stat-item-label">File Totali</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">{{ files.active }}</div>
                        <div class="stat-item-label">File Attivi</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">{{ files.deleted }}</div>
                        <div class="stat-item-label">File Eliminati</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">{{ files.downloaded }}</div>
                        <div class="stat-item-label">File Scaricati</div>
                    </div>
                </div>
                
                <!-- Files by size -->
                <div class="mt-4">
                    <h4 class="mb-2">Spazio Storage</h4>
                    <div class="disk-chart">
                        <div class="disk-chart-bar storage">
                            <div class="disk-chart-fill storage" style="width: {{ storage_percent }}%"></div>
                        </div>
                        <div class="disk-chart-labels">
                            <span>File: {{ files.total_size_human }}</span>
                            <span></span>
                            <span>Disco: {{ disk.total_human }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üïê Attivit√† Recente</h2>
            </div>
            <div class="card-body">
                {% if recent_files %}
                <div class="activity-list">
                    {% for file in recent_files %}
                    <div class="activity-item">
                        <div class="activity-icon {{ 'danger' if file.deleted else 'success' }}">
                            {{ 'üóëÔ∏è' if file.deleted else 'üì•' if file.downloaded_at else 'üì§' }}
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">{{ file.job_id }}</div>
                            <div class="activity-meta">
                                {{ file.file_size_human }} ‚Ä¢ 
                                {% if file.deleted %}
                                    Eliminato
                                {% elif file.downloaded_at %}
                                    Scaricato {{ file.downloaded_at_human }}
                                {% else %}
                                    Caricato {{ file.uploaded_at_human }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìÇ</div>
                    <h3 class="empty-state-title">Nessuna attivit√† recente</h3>
                </div>
                {% endif %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
